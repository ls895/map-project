var map,gmap={};gmap.init=function(){map=new google.maps.Map(document.getElementById("map"),{center:{lat:0,lng:180},zoom:10}),gmap.geocoder=new google.maps.Geocoder,gmap.gdirection=new google.maps.DirectionsService,gmap.gdisplay=new google.maps.DirectionsRenderer,gmap.gdisplay.setMap(map),gmap.gdisplay.setPanel(document.getElementById("direction")),VM.initiateMarkers(),VM.createComputedList(),VM.setCenter(locations()[0]),ko.applyBindings(VM)},gmap.geocode=function(a){gmap.geocoder.geocode({address:a.name},function(b,c){if(c===google.maps.GeocoderStatus.OK){var d={lat:b[0].geometry.location.lat(),lng:b[0].geometry.location.lng()};a.position=d,VM.addMarker(a),VM.addLocation(a),VM.setCenter(a)}else alert("Geocode for "+a.name+" was not successful for the following reason: "+c)})},gmap.direction=function(a,b,c){return a.transport.time.value()?(VM.directionLoading(!0),gmap.directionRequest={origin:a.name,destination:b.name,travelMode:google.maps.TravelMode[c],transitOptions:{departureTime:a.transport.time.value()},drivingOptions:{departureTime:a.transport.time.value()}},void gmap.gdirection.route(gmap.directionRequest,function(b,c){if(c===google.maps.DirectionsStatus.OK){var d=b.routes[0].legs[0];VM.setDirections(a,{distance:d.distance.text,duration:d.duration.text}),gmap.gdisplay.setDirections(b),VM.directionLoading(!1)}else window.alert("Directions request failed due to "+c+".")})):void window.alert("Choose departure time before submitting request.")};var flickr={};flickr.API_KEY="148419e552f69164e56198093ea40634",flickr.URL="https://api.flickr.com/services/rest/?method=flickr.photos.search",flickr.sendRequest=function(a){VM.imageLoading(!0),flickr.buildURL(a.name),$.ajax({url:flickr.URL}).done(function(a){return function(a){var b=a.photos.photo;VM.thumbnail(flickr.buildImageURL(b[0])),VM.imageLoading(!1)}}(a)).fail(function(){window.alert("Flickr Image for location: "+a.name+" cannot be loaded. Try again later.")})},flickr.buildURL=function(a){flickr.URL+="&api_key="+flickr.API_KEY,flickr.URL+="&format=json",flickr.URL+="&nojsoncallback=1",flickr.URL+="&text="+a,flickr.URL+="&content_type=1",flickr.URL+="&sort=relevance",flickr.URL+="&privacy_filter=1",flickr.URL+="&per_page=20"},flickr.buildImageURL=function(a){var b="https://farm{farm-id}.staticflickr.com/{server-id}/{id}_{secret}.jpg";return b=b.replace("{farm-id}",a.farm),b=b.replace("{server-id}",a.server),b=b.replace("{id}",a.id),b=b.replace("{secret}",a.secret)};var wiki={};wiki.sendRequest=function(a){VM.wikiLoading(!0),wiki.buildURL(a.name),$.ajax({url:wiki.URL,dataType:"jsonp"}).done(function(a){return function(b){var c=b.query.pages,d=c[Object.keys(c)[0]].extract;VM.setWikiContent(a,d),VM.wikiLoading(!1)}}(a)).fail(function(){window.alert("Wikipedia content for "+a.name+" cannot be loaded. Try again later.")})},wiki.buildURL=function(a){wiki.URL="https://en.wikipedia.org/w/api.php?format=json&action=query&prop=extracts&exintro=&explaintext=&redirects=1&titles={title}",wiki.URL=wiki.URL.replace("{title}",a)};