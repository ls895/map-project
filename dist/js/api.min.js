var map,gmap={};gmap.init=function(){map=new google.maps.Map(document.getElementById("map"),{center:{lat:0,lng:0},zoom:13}),gmap.service=new google.maps.places.PlacesService(map),gmap.gdirection=new google.maps.DirectionsService,gmap.gdisplay=new google.maps.DirectionsRenderer,gmap.gdisplay.setMap(map),gmap.gdisplay.setPanel(document.getElementById("direction")),VM.googleReady(!0),VM.initiateMarkers(),VM.createComputedList(),VM.setBounds(),ko.applyBindings(VM)},gmap.searchPlace=function(a){var b={query:a.name};gmap.service.textSearch(b,function(b,c){c==google.maps.places.PlacesServiceStatus.OK?gmap.getDetail(b[0].place_id,a):window.alert("Google places search for "+a.name+" was not successful for the following reason: "+c)})},gmap.getDetail=function(a,b){var c={placeId:a};gmap.service.getDetails(c,function(c,d){if(d==google.maps.places.PlacesServiceStatus.OK){var e={lat:c.geometry.location.lat(),lng:c.geometry.location.lng()};b.position=e,VM.addMarker(b),VM.addLocation(b),VM.setCenter(b)}else window.alert("Google places detailed search for "+a+" was not successful for the following reason: "+d)})},gmap.direction=function(a,b,c){return a.transport.time.value()?(VM.directionLoading(!0),gmap.directionRequest={origin:a.position,destination:b.position,travelMode:google.maps.TravelMode[c],transitOptions:{departureTime:a.transport.time.value()},drivingOptions:{departureTime:a.transport.time.value()}},void gmap.gdirection.route(gmap.directionRequest,function(b,c){if(c===google.maps.DirectionsStatus.OK){var d=b.routes[0].legs[0];VM.setDirections(a,{distance:d.distance.text,duration:d.duration.text}),gmap.gdisplay.setDirections(b),VM.directionLoading(!1)}else window.alert("Directions request failed due to "+c+".")})):void window.alert("Choose departure time before submitting request.")},gmap.onError=function(){window.alert("Unable to load Google Maps. Application now starts in semi mode without Google Maps related functionality."),VM.createComputedList(),ko.applyBindings(VM)};var flickr={};flickr.API_KEY="148419e552f69164e56198093ea40634",flickr.URL="https://api.flickr.com/services/rest/?method=flickr.photos.search",flickr.sendRequest=function(a){VM.imageLoading(!0),flickr.buildURL(a.name),$.ajax({url:flickr.URL}).done(function(a){return function(b){var c=b.photos.photo,d=flickr.buildImageURL(c[0]);VM.setThumbnail(a,d),VM.imageLoading(!1)}}(a)).fail(function(b,c,d){window.alert("Flickr Image for location: "+a.name+" cannot be loaded due to reason: "+c+". Try again later.")})},flickr.buildURL=function(a){flickr.URL+="&api_key="+flickr.API_KEY,flickr.URL+="&format=json",flickr.URL+="&nojsoncallback=1",flickr.URL+="&text="+a,flickr.URL+="&content_type=1",flickr.URL+="&sort=interestingness-desc",flickr.URL+="&privacy_filter=1",flickr.URL+="&per_page=5"},flickr.buildImageURL=function(a){var b="https://farm{farm-id}.staticflickr.com/{server-id}/{id}_{secret}.jpg";return b=b.replace("{farm-id}",a.farm),b=b.replace("{server-id}",a.server),b=b.replace("{id}",a.id),b=b.replace("{secret}",a.secret)};var wiki={};wiki.sendRequest=function(a){VM.wikiLoading(!0),wiki.buildURL(a.name),$.ajax({url:wiki.URL,dataType:"jsonp",timeout:5e3}).done(function(a){return function(b){var c=b.query.pages,d=c[Object.keys(c)[0]].extract;VM.setWikiContent(a,d),VM.wikiLoading(!1)}}(a)).fail(function(b,c,d){"timeout"===c?window.alert("Request timeout. Try again later."):window.alert("Wikipedia content for "+a.name+" cannot be loaded due to reason: "+c+". Try again later.")})},wiki.buildURL=function(a){wiki.URL="https://en.wikipedia.org/w/api.php?format=json&action=query&prop=extracts&exintro=&explaintext=&redirects=1&titles={title}",wiki.URL=wiki.URL.replace("{title}",a)};