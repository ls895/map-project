var TimeModel=function(){this.directionOK=ko.observable(!1),this.value=ko.observable(),this.current=new Date};TimeModel.prototype.deselectable=!0,TimeModel.prototype.showCalendar=!1,TimeModel.prototype.showToday=!0,TimeModel.prototype.showTime=!0,TimeModel.prototype.showNow=!0,TimeModel.prototype.militaryTime=!1,TimeModel.prototype.min=null,TimeModel.prototype.max=null,TimeModel.prototype.autoclose=!0,TimeModel.prototype.strings={months:["January","February","March","April","May","June","July","August","September","October","November","December"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],time:["AM","PM"]};var Location=function(a,b){this.name=a,this.position=b,this.transport={time:new TimeModel,type:"TRANSIT",duration:ko.observable(""),distance:ko.observable("")},this.wikiExtract=ko.observable(),this.thumbnail=ko.observable()};Location.prototype.dropMarker=function(){this.marker.setAnimation(null),this.marker.setAnimation(google.maps.Animation.DROP)},Location.prototype.openInfoWindow=function(){this.infoWindow=new google.maps.InfoWindow({content:'<p class="lead">'+this.name+"</p>"}),this.infoWindow.open(map,this.marker)},Location.prototype.closeInfoWindow=function(){this.marker.setAnimation(null),this.infoWindow&&(this.infoWindow.close(),this.infoWindow=null)},Location.prototype.setMarkerVisible=function(a){this.marker.setVisible(a)},Location.prototype.addMarker=function(){this.marker=new google.maps.Marker({position:this.position,map:map,animation:google.maps.Animation.DROP}),this.marker.addListener("click",function(a){return function(){a.openInfoWindow()}}(this))},Location.prototype.setWikiContent=function(a){this.wikiExtract(a)},Location.prototype.setThumbnail=function(a){this.thumbnail(a)},Location.prototype.setDirections=function(a){this.transport.duration(a.duration),this.transport.distance(a.distance),this.transport.time.directionOK(!0)};var locations=ko.observableArray([new Location("HMS Belfast",{lat:51.506579,lng:-.08138899999994464}),new Location("Big Ben",{lat:51.50072919999999,lng:-.12462540000001354}),new Location("Westminster Bridge",{lat:51.5008638,lng:-.12196449999999004}),new Location("London Eye",{lat:51.503324,lng:-.1195430000000215}),new Location("Oxford Street",{lat:51.5149255,lng:-.14482590000000073}),new Location("London School of Economics",{lat:51.5144077,lng:-.11737659999994321}),new Location("King's College London",{lat:51.51148639999999,lng:-.11599699999999302}),new Location("Old Royal Naval College",{lat:51.4827375,lng:-.008513499999935448})]);ko.bindingHandlers.sortable={update:function(a,b,c,d){var e=d.editMode(),f=$(a),g=b();if(e){var h={update:function(a,b){var c=ko.dataFor(b.item[0]),d=b.item.index(),e=g.indexOf(c);if(e!=d){var f=g();g([]),f.splice(e,1),f.splice(d,0,c),g(f)}}};f.sortable(h)}else f.sortable("instance")&&f.sortable("destroy")}};var BaseViewModel=function(){var a=this;a.googleReady=ko.observable(!1),a.editMode=ko.observable(!1),a.sortMode=ko.observable(!1),a.placesPage=ko.observable(!0),a.transportPage=ko.observable(!1),a.transportType="DRIVING",a.showDirections=ko.observable(!1),a.imageLoading=ko.observable(!1),a.wikiLoading=ko.observable(!1),a.directionLoading=ko.observable(!1),a.showDetail=ko.observable(!1),a.filterText=ko.observable(""),a.newLocation=ko.observable(""),a.activeLocation=ko.observable(),a.locations=locations,a.openInfoWindow=function(){if(a.activeLocation(this),a.googleReady()){for(var b=0;b<locations().length;b++)locations()[b].closeInfoWindow();this.openInfoWindow(),this.dropMarker(),a.setCenter(this);var c=new google.maps.LatLngBounds;c.extend(this.marker.getPosition()),map.fitBounds(c)}wiki.sendRequest(this),flickr.sendRequest(this),a.enablePlaces(),a.showDetail(!0)},a.initiateMarkers=function(){for(var a=0;a<locations().length;a++)locations()[a].addMarker()},a.setCenter=function(a){map.setCenter(a.position)},a.setBounds=function(){for(var a=new google.maps.LatLngBounds,b=0;b<locations().length;b++)a.extend(locations()[b].marker.getPosition());map.fitBounds(a)},a.createComputedList=function(){a.googleReady()?a.filteredLocations=ko.computed(function(){var b=a.filterText().toLowerCase(),c=locations();if(b)return ko.utils.arrayFilter(c,function(a){var c=a.name.toLowerCase().indexOf(b)>=0;return c?(a.setMarkerVisible(!0),!0):(a.closeInfoWindow(),a.setMarkerVisible(!1),!1)});for(var d=0;d<c.length;d++)c[d].setMarkerVisible(!0);return locations()}):a.filteredLocations=ko.computed(function(){var b=a.filterText().toLowerCase(),c=locations();return b?ko.utils.arrayFilter(c,function(a){var c=a.name.toLowerCase().indexOf(b)>=0;return!!c}):locations()})},a.editLocation=function(){a.editMode()?(a.editMode(!1),a.enableFilter()):(a.editMode(!0),a.disableFilter())},a.handleAdd=function(){a.newLocation().length>0?a.googleReady()?gmap.searchPlace(a.newLocation()):a.createLocation(a.newLocation(),{}):window.alert("Input field cannot be empty")},a.createLocation=function(b,c){var d=new Location(b,c);a.addLocation(d)},a.addLocation=function(b){a.googleReady()&&a.addLocationToMap(b),locations.push(b)},a.addLocationToMap=function(b){b.addMarker(),a.setCenter(b)},a.handleDelete=function(){a.googleReady()&&(this.setMarkerVisible(!1),this.closeInfoWindow()),a.removeLocation(this)},a.removeLocation=function(a){locations.remove(a)},a.enableTransport=function(){a.disableFilter(),a.editMode(!1),a.placesPage(!1),a.transportPage(!0),a.showDetail(!1)},a.enablePlaces=function(){a.showDirections(!1),a.transportPage(!1),a.placesPage(!0),a.enableFilter()},a.showMap=function(){a.placesPage(!1),a.transportPage(!1)},a.enableFilter=function(){a.sortMode(!1)},a.disableFilter=function(){a.filterText(""),a.sortMode(!0)},a.requestDirection=function(){this.transport.time.directionOK(!1);var a=this,b=locations.indexOf(a),c=locations()[b+1],d=a.transport.type;gmap.direction(a,c,d)},a.setDirections=function(a,b){a.setDirections(b)},a.setWikiContent=function(a,b){a.setWikiContent(b)},a.setThumbnail=function(a,b){a.setThumbnail(b)},a.detailedDirections=function(){a.showDirections(!0)},a.closeDetail=function(){a.showDetail(!1)},a.closeLast=function(){a.showDetail(!1),a.showDirections(!1)}},LogInViewModel=function(){},VM=new BaseViewModel;