var TimeModel=function(){this.directionOK=ko.observable(!1),this.value=ko.observable(),this.current=new Date};TimeModel.prototype.deselectable=!0,TimeModel.prototype.showCalendar=!1,TimeModel.prototype.showToday=!0,TimeModel.prototype.showTime=!0,TimeModel.prototype.showNow=!0,TimeModel.prototype.militaryTime=!1,TimeModel.prototype.min=null,TimeModel.prototype.max=null,TimeModel.prototype.autoclose=!0,TimeModel.prototype.strings={months:["January","February","March","April","May","June","July","August","September","October","November","December"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],time:["AM","PM"]};var locations=ko.observableArray([{name:"London Gatwick Airport",position:{lat:51.1536621,lng:-.18206290000000536},transport:{time:new TimeModel,type:"TRANSIT",duration:ko.observable(""),distance:ko.observable("")},wikiExtract:ko.observable(),thumbnail:ko.observable()},{name:"King's Cross",position:{lat:51.53170300000001,lng:-.12431049999997867},transport:{time:new TimeModel,type:"TRANSIT",duration:ko.observable(""),distance:ko.observable("")},wikiExtract:ko.observable(),thumbnail:ko.observable()},{name:"Emirates Stadium",position:{lat:51.55572979999999,lng:-.10831180000002405},transport:{time:new TimeModel,type:"TRANSIT",duration:ko.observable(""),distance:ko.observable("")},wikiExtract:ko.observable(),thumbnail:ko.observable()},{name:"Canary Wharf",position:{lat:51.5054306,lng:-.023533300000053714},transport:{time:new TimeModel,type:"TRANSIT",duration:ko.observable(""),distance:ko.observable("")},wikiExtract:ko.observable(),thumbnail:ko.observable()},{name:"London Bridge",position:{lat:51.5078788,lng:-.08773210000003928},transport:{time:new TimeModel,type:"TRANSIT",duration:ko.observable(""),distance:ko.observable("")},wikiExtract:ko.observable(),thumbnail:ko.observable()}]);ko.bindingHandlers.sortable={update:function(a,b,c,d){var e=d.editMode(),f=$(a),g=b();if(e){var h={sort:function(a,b){VM.disableFilter()},update:function(a,b){var c=ko.dataFor(b.item[0]),d=b.item.index(),e=g.indexOf(c);if(e!=d){var f=g();g([]),f.splice(e,1),f.splice(d,0,c),g(f)}VM.enableFilter()}};f.sortable(h)}else f.sortable("instance")&&f.sortable("destroy"),VM.enableFilter()}};var ViewModel=function(){var a=this;a.thumbnail=ko.observable(),a.editMode=ko.observable(!1),a.sortMode=ko.observable(!1),a.placesPage=ko.observable(!0),a.transportPage=ko.observable(!1),a.transportType="DRIVING",a.showDirections=ko.observable(!1),a.imageLoading=ko.observable(!1),a.wikiLoading=ko.observable(!1),a.directionLoading=ko.observable(!1),a.showDetail=ko.observable(!1),a.filterText=ko.observable(""),a.newLocation="",a.activeLocation=ko.observable(),a.locations=locations,a.photoArray=ko.observableArray([]),a.editLocation=function(){a.editMode()?a.editMode(!1):a.editMode(!0)},a.detailedDirections=function(){a.showDirections(!0)},a.openInfoWindow=function(){a.thumbnail(""),a.activeLocation(this);for(var b=0;b<locations().length;b++)a.closeInfoWindow(locations()[b]);this.infoWindow=new google.maps.InfoWindow({content:'<p class="lead">'+this.name+"</p>"}),this.infoWindow.open(map,this.marker),a.dropMarker.call(this),a.setCenter(this),wiki.sendRequest(this),flickr.sendRequest(this),a.enablePlaces(),a.showDetail(!0)},a.closeInfoWindow=function(a){a.marker.setAnimation(null),a.infoWindow&&(a.infoWindow.close(),a.infoWindow=null)},a.setWikiContent=function(a,b){a.wikiExtract(b)},a.dropMarker=function(){this.marker.setAnimation(null),this.marker.setAnimation(google.maps.Animation.DROP)},a.setMarkerVisible=function(a,b){a.marker.setVisible(b)},a.addMarker=function(b){b.marker=new google.maps.Marker({position:b.position,map:map,animation:google.maps.Animation.DROP}),b.marker.addListener("click",function(b){return function(){a.openInfoWindow.call(b)}}(b))},a.initiateMarkers=function(){for(var b=0;b<locations().length;b++)a.addMarker(locations()[b])},a.createComputedList=function(){a.filteredLocations=ko.computed(function(){var b=a.filterText().toLowerCase(),c=locations();if(b)return ko.utils.arrayFilter(c,function(c){var d=c.name.toLowerCase().indexOf(b)>=0;return!!d||(a.closeInfoWindow(c),a.setMarkerVisible(c,!1),!1)});for(var d=0;d<c.length;d++)a.setMarkerVisible(c[d],!0);return locations()})},a.setCenter=function(a){map.setCenter(a.position)},a.handleAdd=function(){if(a.newLocation.length>0){var b={};b.name=a.newLocation,b.transport={time:new TimeModel,type:"TRANSIT",duration:ko.observable(""),distance:ko.observable("")},b.wikiExtract=ko.observable(),gmap.geocode(b)}else console.log("Input field cannot be empty")},a.addLocation=function(a){locations.push(a)},a.handleDelete=function(){a.setMarkerVisible(this,!1),a.closeInfoWindow(this),locations.remove(this)},a.enableTransport=function(){a.disableFilter(),a.editMode(!1),a.placesPage(!1),a.transportPage(!0),a.showDetail(!1)},a.enablePlaces=function(){a.showDirections(!1),a.transportPage(!1),a.placesPage(!0),a.enableFilter()},a.showMap=function(){a.placesPage(!1),a.transportPage(!1)},a.enableFilter=function(){VM.sortMode(!1)},a.disableFilter=function(){a.filterText(""),a.sortMode(!0)},a.requestDirection=function(){this.directionOK=ko.observable(!1);var a=this,b=locations.indexOf(a),c=locations()[b+1],d=a.transport.type;gmap.direction(a,c,d)},a.setDirections=function(a,b){a.transport.duration(b.duration),a.transport.distance(b.distance),a.transport.time.directionOK(!0)},a.closeDetail=function(){a.showDetail(!1)},a.closeLast=function(){a.showDetail(!1),a.showDirections(!1)}},VM=new ViewModel;