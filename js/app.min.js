var TimeModel=function(){this.directionOK=ko.observable(!1),this.value=ko.observable(),this.current=new Date};TimeModel.prototype.deselectable=!0,TimeModel.prototype.showCalendar=!1,TimeModel.prototype.showToday=!0,TimeModel.prototype.showTime=!0,TimeModel.prototype.showNow=!0,TimeModel.prototype.militaryTime=!1,TimeModel.prototype.min=null,TimeModel.prototype.max=null,TimeModel.prototype.autoclose=!0,TimeModel.prototype.strings={months:["January","February","March","April","May","June","July","August","September","October","November","December"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],time:["AM","PM"]};var locations=ko.observableArray([{name:"HMS Belfast",position:{lat:51.506579,lng:-.08138899999994464},transport:{time:new TimeModel,type:"TRANSIT",duration:ko.observable(""),distance:ko.observable("")},wikiExtract:ko.observable(),thumbnail:ko.observable()},{name:"Big Ben",position:{lat:51.50072919999999,lng:-.12462540000001354},transport:{time:new TimeModel,type:"TRANSIT",duration:ko.observable(""),distance:ko.observable("")},wikiExtract:ko.observable(),thumbnail:ko.observable()},{name:"Westminster Bridge",position:{lat:51.5008638,lng:-.12196449999999004},transport:{time:new TimeModel,type:"TRANSIT",duration:ko.observable(""),distance:ko.observable("")},wikiExtract:ko.observable(),thumbnail:ko.observable()},{name:"London Eye",position:{lat:51.503324,lng:-.1195430000000215},transport:{time:new TimeModel,type:"TRANSIT",duration:ko.observable(""),distance:ko.observable("")},wikiExtract:ko.observable(),thumbnail:ko.observable()},{name:"Oxford Street",position:{lat:51.5149255,lng:-.14482590000000073},transport:{time:new TimeModel,type:"TRANSIT",duration:ko.observable(""),distance:ko.observable("")},wikiExtract:ko.observable(),thumbnail:ko.observable()},{name:"London School of Economics",position:{lat:51.5144077,lng:-.11737659999994321},transport:{time:new TimeModel,type:"TRANSIT",duration:ko.observable(""),distance:ko.observable("")},wikiExtract:ko.observable(),thumbnail:ko.observable()},{name:"King's College London",position:{lat:51.51148639999999,lng:-.11599699999999302},transport:{time:new TimeModel,type:"TRANSIT",duration:ko.observable(""),distance:ko.observable("")},wikiExtract:ko.observable(),thumbnail:ko.observable()},{name:"Old Royal Naval College",position:{lat:51.4827375,lng:-.008513499999935448},transport:{time:new TimeModel,type:"TRANSIT",duration:ko.observable(""),distance:ko.observable("")},wikiExtract:ko.observable(),thumbnail:ko.observable()}]);ko.bindingHandlers.sortable={update:function(a,b,c,d){var e=d.editMode(),f=$(a),g=b();if(e){var h={update:function(a,b){var c=ko.dataFor(b.item[0]),d=b.item.index(),e=g.indexOf(c);if(e!=d){var f=g();g([]),f.splice(e,1),f.splice(d,0,c),g(f)}}};f.sortable(h)}else f.sortable("instance")&&f.sortable("destroy")}};var ViewModel=function(){var a=this;a.googleReady=ko.observable(!1),a.editMode=ko.observable(!1),a.sortMode=ko.observable(!1),a.placesPage=ko.observable(!0),a.transportPage=ko.observable(!1),a.transportType="DRIVING",a.showDirections=ko.observable(!1),a.imageLoading=ko.observable(!1),a.wikiLoading=ko.observable(!1),a.directionLoading=ko.observable(!1),a.showDetail=ko.observable(!1),a.filterText=ko.observable(""),a.newLocation=ko.observable(""),a.activeLocation=ko.observable(),a.locations=locations,a.openInfoWindow=function(){if(a.activeLocation(this),a.googleReady()){for(var b=0;b<locations().length;b++)a.closeInfoWindow(locations()[b]);this.infoWindow=new google.maps.InfoWindow({content:'<p class="lead">'+this.name+"</p>"}),this.infoWindow.open(map,this.marker),a.dropMarker.call(this),a.setCenter(this);var c=new google.maps.LatLngBounds;c.extend(this.marker.getPosition()),map.fitBounds(c)}wiki.sendRequest(this),flickr.sendRequest(this),a.enablePlaces(),a.showDetail(!0)},a.closeInfoWindow=function(a){a.marker.setAnimation(null),a.infoWindow&&(a.infoWindow.close(),a.infoWindow=null)},a.dropMarker=function(){this.marker.setAnimation(null),this.marker.setAnimation(google.maps.Animation.DROP)},a.setMarkerVisible=function(a,b){a.marker.setVisible(b)},a.addMarker=function(b){b.marker=new google.maps.Marker({position:b.position,map:map,animation:google.maps.Animation.DROP}),b.marker.addListener("click",function(b){return function(){a.openInfoWindow.call(b)}}(b))},a.initiateMarkers=function(){for(var b=0;b<locations().length;b++)a.addMarker(locations()[b])},a.setCenter=function(a){map.setCenter(a.position)},a.setBounds=function(){for(var a=new google.maps.LatLngBounds,b=0;b<locations().length;b++)a.extend(locations()[b].marker.getPosition());map.fitBounds(a)},a.createComputedList=function(){a.googleReady()?a.filteredLocations=ko.computed(function(){var b=a.filterText().toLowerCase(),c=locations();if(b)return ko.utils.arrayFilter(c,function(c){var d=c.name.toLowerCase().indexOf(b)>=0;return!!d||(a.closeInfoWindow(c),a.setMarkerVisible(c,!1),!1)});for(var d=0;d<c.length;d++)a.setMarkerVisible(c[d],!0);return locations()}):a.filteredLocations=ko.computed(function(){var b=a.filterText().toLowerCase(),c=locations();return b?ko.utils.arrayFilter(c,function(a){var c=a.name.toLowerCase().indexOf(b)>=0;return!!c}):locations()})},a.editLocation=function(){a.editMode()?(a.editMode(!1),a.enableFilter()):(a.editMode(!0),a.disableFilter())},a.handleAdd=function(){if(a.newLocation().length>0){var b={};b.name=a.newLocation(),b.transport={time:new TimeModel,type:"TRANSIT",duration:ko.observable(""),distance:ko.observable("")},b.thumbnail=ko.observable(),b.wikiExtract=ko.observable(),a.googleReady()?gmap.searchPlace(b):a.addLocation(b),a.newLocation("")}else window.alert("Input field cannot be empty")},a.addLocation=function(a){locations.push(a)},a.handleDelete=function(){a.googleReady()&&(a.setMarkerVisible(this,!1),a.closeInfoWindow(this)),locations.remove(this)},a.enableTransport=function(){a.disableFilter(),a.editMode(!1),a.placesPage(!1),a.transportPage(!0),a.showDetail(!1)},a.enablePlaces=function(){a.showDirections(!1),a.transportPage(!1),a.placesPage(!0),a.enableFilter()},a.showMap=function(){a.placesPage(!1),a.transportPage(!1)},a.enableFilter=function(){VM.sortMode(!1)},a.disableFilter=function(){a.filterText(""),a.sortMode(!0)},a.requestDirection=function(){this.transport.time.directionOK(!1);var a=this,b=locations.indexOf(a),c=locations()[b+1],d=a.transport.type;gmap.direction(a,c,d)},a.setDirections=function(a,b){a.transport.duration(b.duration),a.transport.distance(b.distance),a.transport.time.directionOK(!0)},a.detailedDirections=function(){a.showDirections(!0)},a.setWikiContent=function(a,b){a.wikiExtract(b)},a.setThumbnail=function(a,b){a.thumbnail(b)},a.closeDetail=function(){a.showDetail(!1)},a.closeLast=function(){a.showDetail(!1),a.showDirections(!1)}},VM=new ViewModel;